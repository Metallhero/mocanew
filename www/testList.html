<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta content="width=device-width, initial-scale=1.0,user-scalable=no" name="viewport" />
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>MoCA</title>
    <link href="Content/bootstrap.css" rel="stylesheet" />
    <link href='http://fonts.googleapis.com/css?family=Open+Sans:400,600,700,300,700italic' rel='stylesheet' type='text/css'>
    <link href="Content/style-mectronic.css" rel="stylesheet" />
    <link href="Content/Site.css" rel="stylesheet" />
    <script src="Scripts/modernizr-2.6.2.js"></script>
    <script src="Scripts/jquery-1.10.2.js"></script>
    <script src="Scripts/bootstrap.js"></script>
    <script src="Scripts/respond.js"></script>
    <script src="Scripts/jquery.session.js"></script>
    <link href="Content/font-awesome/css/font-awesome.css" rel="stylesheet" />
    <link href="Content/style-responsive.css" rel="stylesheet" />
    <link href="Content/default.css" rel="stylesheet" />
    <!--@*Select2*@-->
    <link href="Scripts/select2/select2_metro.css" rel="stylesheet" />
    <script src="Scripts/select2/select2.min.js"></script>
    <!--=======-->
    <script src="Scripts/jquery.bpopup.min.js"></script>

    <!--@*Bootstrap switch*@-->
    <link href="Content/bootstrap-switch/bootstrap-switch.css" rel="stylesheet" />
    <script src="Content/bootstrap-switch/bootstrap-switch.min.js"></script>
    <!--@*===============*@-->
    <script src="Scripts/phonegap-1.1.0.js"></script>
    <script src="Scripts/js/db.manager.js"></script>
    <script src="Scripts/js/site.manage.js"></script>
</head>
<body class="login">
    <!--section Popup -->
    <div id="popups"></div>
    <!--section end -->
    <div class="header navbar navbar-inverse ">
        <div class="header-inner">
            <a href="/" class="navbar-brand">
                <span>e-MoCA version 8.1</span>
            </a>

            <a data-target=".navbar-collapse" data-toggle="collapse" class="navbar-toggle" href="javascript:;">
                <img alt="" src="Content/img/sidebar-toggler.jpg">
            </a>
            <ul class="nav navbar-nav pull-right">
                <!-- BEGIN USER LOGIN DROPDOWN -->
                <li class="user">
                    <a data-close-others="true" data-hover="dropdown" data-toggle="dropdown" class="dropdown-toggle" href="#" style="padding-top:10px;padding-bottom:10px;">
                        <span class="username">
                            <!--Username-->
                        </span>
                        <i class="icon-angle-down"></i>
                    </a>
                    <ul class="dropdown-menu"><li><a href="index.html" >Start new test</a></li><li><a href="testList.html">Show test results</a></li></ul>
                </li>
                <!-- END USER LOGIN DROPDOWN -->
            </ul>
        </div>

    </div>

    <div class="content">

        <div id="portlet-email" style="display:none">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h4 class="modal-title">Send by email</h4>
                    </div>
                    <div class="modal-body">
                        <input type="hidden" id="chosentestid" />
                        <div class="input-icon">
                            <i class="icon-envelope" style="margin-top: 9px; "></i>
                            <input class="form-control placeholder-no-fix" type="text" placeholder="Email" name="email" id="txtEmail" />
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn default" onclick="$('#portlet-email').bPopup().close();">Cancel</button>
                        <button class="btn purple btnSendEmail"><i class="icon-ok"></i> Send</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="page-content">

            <div id="portlet-reload" class="modal fade" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                            <h4 class="modal-title">Confirm</h4>
                        </div>
                        <div class="modal-body">
                            Are you sere reset?
                        </div>
                        <div class="modal-footer">
                            <button type="submit" class="btn" id="btnReset" onclick="window.location.reload();"><i class="icon-ok"></i> Reset</button>
                            <button type="button" class="btn default" data-dismiss="modal">Cansel</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row-fluid">
                <div class="col-md-12">
                    <h3 class="page-title">
                        Administration
                    </h3>
                </div>
            </div>
            <div class="row-fluid">
                <div class="col-md-12">
                    <div class="portlet box purple">
                        <div class="portlet-title">
                            <div class="caption">Tests </div>
                            <div class="actions">
                                <div class="btn-group">
                                    <a class="btn purple" href="#" data-toggle="dropdown">
                                        Columns <i class="icon-angle-down"></i>
                                    </a>
                                    <div id="sample_2_column_toggler" class="dropdown-menu hold-on-click dropdown-checkboxes pull-right">
                                        <label>
                                            <input type="checkbox" checked data-column="0">Chart Number
                                        </label>
                                        <label>
                                            <input type="checkbox" checked data-column="1">Administered by
                                        </label>
                                        <label>
                                            <input type="checkbox" checked data-column="2">Patient
                                        </label>
                                        <label>
                                            <input type="checkbox" checked data-column="3">Date
                                        </label>
                                        <label>
                                            <input type="checkbox" checked data-column="4">Result
                                        </label>
                                        <label>
                                            <input type="checkbox" checked data-column="5">Email
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="tools">
                            </div>
                        </div>
                        <div class="portlet-body">
                            <div class="row-fluid" style="text-align: center;margin-bottom: 20px;">
                                <button type="button" class="btn purple" onclick="ShowConfirmPopup('Start new test', 'Are you sure ?', 'index.html')">
                                    <i class="icon-arrow-left"></i>
                                    Start new test
                                </button>
                            </div>


                            <table class="table table-striped table-bordered table-hover" id="sample_2" style="display:none">
                                <thead>
                                    <tr>
                                        <th>Chart Number</th>
                                        <th>Administered by</th>
                                        <th>Patient</th>
                                        <th>Date</th>
                                        <th>Result</th>
                                        <th>Send by email</th>
                                    </tr>



                                </thead>
                                <tbody id="gridTable"></tbody>
                            </table>
                            <img src="Content/img/loading.gif" id="grid_preloader" style="display: none" />
                        </div>
                    </div>
                    <!-- END FORM-->
                </div>
                <!-- END PORTLET-->
                <div class="col-md-4 hidden">
                </div>
            </div>
            <div class="row-fluid" style="bottom: 70px;">
                <div class="col-md-12">
                    <button type="button" class="btn purple" onclick="window.history.back();return false;" id="btnBack"><i class="icon-chevron-left"></i></button>
                </div>
            </div>
            <!-- END PAGE CONTENT-->
        </div>
        <!-- END PAGE -->
    </div>

    </div>

    <div class="footer">
        <div class="copyright"> e-MoCA © Copyright 2014. </div>
        <div class="footer-tools">
            <span class="go-top">
                <i class="icon-angle-up"></i>
            </span>
        </div>
    </div>



    <!--section Scripts -->
    <script src="Scripts/table-advanced.js"></script>
    <script src="Scripts/data-tables/jquery.dataTables.min.js"></script>
    <script src="Scripts/data-tables/DT_bootstrap.js"></script>
    <link href="Scripts/data-tables/DT_bootstrap.css" rel="stylesheet" />
    <script src="Scripts/date.format.js"></script>
    <script type="text/javascript">
        function sendEmail(testId) {
            $("#portlet-email").bPopup({
                modalClose: false,
                onOpen: function () { $("#chosentestid").val(testId); },
                onClose: function () { $("#chosentestid").val(''); }
            });

        }
        $(document).ready(function () {
            var gridData = [];
            DB.selectData("Select MocaTest.testID, MocaTestClients.chartNumber,  MocaTestClients.name as 'Client', MocaTestUsers.name as 'Admin', MocaTest.testDate  From MocaTest inner join MocaTestClients on MocaTest.clientID = MocaTestClients.clientID inner join MocaTestUsers on MocaTest.userID = MocaTestUsers.userID", function (results) {
                for (var i = 0; i < results.rows.length; i++) {
                    var temItem = results.rows.item(i);
                    gridData.push(temItem);
                }
                $.each(gridData, function (k, v) {
                    $('#gridTable').append('<tr><td>' + v.chartNumber + '</td><td>' + v.Admin + '</td><td>' + v.Client + '</td><td>' + v.testDate + '</td><td><a href="result.html?id=' + v.testID + '&comments=1">Results</a></td><td> <a href="#" onclick="sendEmail(' + v.testID + ');return false;">Results</a></td></tr>');
                    // <td><a href="chartTest.html?id=' + v.testID + '">Chart</a></td><td><a href="chartTest.html?id=' + v.testID + '#file">Chart</a> | <a href="web/viewer.html?id=' + v.testID + '&comments=1#file">With comments</a> | <a href="web/viewer.html?id=' + v.testID + '#file">Without comments</a></td>
                });
                TableAdvanced.init();
            });

        });

        $("#txtEmail").focus(function () {
            $(this).removeClass('error');
        });


        $(".btnSendEmail").click(function () {
            var email = $("#txtEmail").val();
            var testId = $("#chosenTestId").val();
            if (!email || !validateEmail(email)) {
                $("#txtEmail").addClass('error');
                return false;
            }

            $('body').append('<div id="preload"></div>');
            $.ajax({
                url: "/Test/SendEmail",
                type: "POST",
                data: { email: email, testId: testId },
                success: function (data) {
                    if (data) {
                        $('#portlet-email').modal('hide');
                        $('#ok-email').modal();
                        $("#txtEmail").val('')
                    }
                    $("#preload").remove();
                }
            });
        });
    </script>

    <!-- end section-->
</body>
</html>